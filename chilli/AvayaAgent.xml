<?xml version="1.0" ?>
<fsm name="avayaAgent" initial="init">
	<state id="init">
		<onentry>
			<log level = "info">enter init state.</log>
		</onentry>
		<event event="logon" cond="_event.password == _agent.Password">
			<transition  target="logined"/>
		</event>
		<event event="logon">
			<send target="this" type="response" dest="client" event="logon">
				<status>1</status>
				<type>logon</type>
			</send>
		</event>
		<event event=".*">
			<send target="this" type="response" dest="client" eventexpr="_event._name">
				<status>1</status>
				<type type="script">_event._name;</type>
				<mem>未登录</mem>
			</send>
		</event>
		<state id="logined">
			<onentry>
				<log level = "info">enter logined state.</log>
				<send target="this" type="response" dest="client" event="logon">
					<status>0</status>
					<type>logon</type>
				</send>
			</onentry>
			<event event="ping">
				<log level="debug"> ping message</log>
			</event>
			<event event="ConnectError">
				<transition  target="init"/>
			</event>
			<event event="ConnectClose">
				<transition  target="init"/>
			</event>
			<event event="logout">
				<transition  target="init"/>
			</event>
			<event event=".*">
				<log level="warn" type="script">"not process event "+_event._name;</log>
			</event>
		</state>
		
    </state>

</fsm>

