<HTML>
<HEAD>
<TITLE>chilli Agent Client</TITLE>
</HEAD>
<BODY onload="init();">

    <hr />
    <input id="status" width="400" value="未登陆" disabled="disabled" />
    <hr />

    <font>服务器地址</font><input type="text" id="wsUri" value="ws://127.0.0.1:9996" /><p/>
	<font>坐席ID</font><input type="text" id="agentId" value="6001" /><p/>
	<font>密码</font><input type="password" id="password" value="1234" /><p/>
    <input type="button" value="登陆" onclick="Login();" />
	<input type="button" value="登出" onclick="Logout();" />
	
    <script type="text/javascript">

		var websocket;
		var output;
		
		function init(){
			output = document.getElementById("output");
			
		}
		
        function Login() {
			websocket = new WebSocket(document.getElementById("wsUri").value);
            websocket.onopen = function(evt) { onOpen(evt) };
            websocket.onclose = function(evt) { onClose(evt) };
            websocket.onmessage = function(evt) { onMessage(evt) };
            websocket.onerror = function(evt) { onError(evt) };
        }

		function Logout()
		{
			var logout = new Object();
			logout.agentid= document.getElementById("agentId").value;
			logout.password = document.getElementById("password").value;
			logout.event = "logout";
			websocket.close();
		}
		
        function onOpen(evt)
        {
            document.getElementById("status").value = "已连接";
			var login = new Object();
			login.agentid= document.getElementById("agentId").value;
			login.password = document.getElementById("password").value;
			login.event = "logon";
			doSend(JSON.stringify(login));
        }

		function onClose(evt)
		{
			document.getElementById("status").value = "已断开连接";
		}

		function onMessage(evt)
		{
			writeToScreen('<span style="color: blue;">RESPONSE: ' + evt.data+'</span>');
		}

		function onError(evt)
		{
			writeToScreen('<span style="color: red;">ERROR:</span> ' + evt.data);
			document.getElementById("status").value = "已断开连接";
		}

		function doSend(message)
		{
			if(websocket.readyState == 1){
				writeToScreen("SENT: " + message);
				websocket.send(message);
			}
			else{
				document.getElementById("status").value = "未连接";
			}
		}
		
		function writeToScreen(message)
		{
			var pre = document.createElement("p");
			pre.style.wordWrap = "break-word";
			pre.innerHTML = message;
			output.appendChild(pre);
		}
    </script>
	
	<div id="output"></div>
</BODY>
</HTML>
